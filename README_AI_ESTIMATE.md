# AI見積支援（要件概要プロンプト）の仕様案

## 目的
- 見積書に「要件定義」欄を追加し、簡易なドラフトを AI が整理（機能/非機能要件）できるようにする。
- OpenAI API を用いて **システム開発案件（事業区分: 第5種）専用の明細ドラフト** と備考案を自動生成し、営業入力の手間を削減する。
- 仕入れ/ハードウェアなどの第1種事業は対象外（AI生成しない）。

## 要件概要入力 UI
1. **要件概要フィールド**
   - `estimate.requirement_summary`（テキストエリア 2,000 文字程度）。XERO PM とは連携せず、ユーザーが手入力。
   - 「要件定義を整理する」ボタンを設置。ラフに書いた文章を AI が整理し、機能要件/非機能要件を分けて表示。
2. **PM 必要チェック**
   - チェックボックス「PM支援が必要」。ON の場合は AI が PM 専用品目（例: プロジェクトマネジメント）を必ず盛り込む。
3. **AI 生成アクション**
   - 「AIでドラフト生成」ボタンを押すと、要件概要＋整理済みの機能/非機能要件をプロンプトにし、OpenAI API（`gpt-4o-mini` 予定）を呼び出す。
   - 生成結果はモーダルで表示し、「すべて採用」「一部挿入」「再生成」などの操作が可能。

## 明細生成ルール
- 対象は **システム開発** のみ。仕入やハードウェアなど第1種事業に分類される品目は候補から除外。
- 品目は商品マスタ（事業区分第5種）から最適なものを自動選択。顧客業種や要件概要のキーワードに応じてマッピング。
- 数量は **人月単位**。1人月 = 20営業日、1人日は 8 時間。入力された工数(時間) ⇒ 日 ⇒ 人月で算出。
- 単価／原価は商品マスタの値を利用し、原価は AI で変更せず固定（ユーザーが必要に応じて修正）。

## 備考生成
- 明細生成時に備考案（納期条件、変更管理、検収基準など）も同時に作成。既存の備考生成ボタンと統合。
- PM 必要チェックが ON の場合は、PM 体制やコミュニケーション計画に関するテンプレート文を追加。

## 承認フロー連携
- AI が生成したドラフトは `estimate_ai_logs` に JSON で保存し、承認申請画面で参照できるようにする。
- 承認取消時には「AI案に戻す」/「再生成」ボタンを提供し、差戻し後の再提案を効率化。

## 例: プロンプト構成
```
要件概要:
  - Salesforce 連携機能追加、ユーザー50名、PM支援あり
機能要件:
  - 見積入力API、承認フロー同期
非機能要件:
  - 可用性 99.9%、レスポンス < 1s
```
→ これを元に「設計」「開発」「単体テスト」「PM」などの明細を 0.5～1.5人月単位で生成。

## 注意点
- 生成対象は第5種事業に限定すること。
- 仕入やハードウェア（第1種）はユーザーが手動で入力する運用を継続。

# Billing / 請求書一覧

## 目的 / Purpose
- 自社およびMoney Forwardから取得した請求書を一覧表示し、必要な絞り込みとPDF閲覧動線を提供する。

## エントリ条件 / Entry Conditions
- 認証済みユーザーのみアクセス可能 (`AuthenticatedLayout` を利用)。
- Money Forward連携設定が存在する場合に請求書が表示される。

## 主要フロー / Primary Flow
1. ユーザーが請求書一覧画面を開く。
2. 請求月やキーワードで対象データを絞り込み、サマリーカードとテーブルで請求内容を確認する。
3. 各請求書からPDF出力・Money Forward画面リンク・ローカル編集等のアクションを実行できる。

## 状態・例外 / States & Edge Cases
- `error` プロップが渡された場合、画面上部にエラーバナーを表示。
- フィルタ結果が0件のときは「請求データがありません。」と表示。
- Money Forward未連携のローカル請求書は「MF未生成」を表示。
- 金額は `formatCurrency` で円表示、日付は `formatDate` で和暦形式表示。
- 画面アクセスごとにMoney Forwardの請求書同期を実行し、最終同期時刻を通知。
- 請求月フィルタは年月単位での絞り込みを行い、未指定時は全期間を対象とする。
- Money Forwardトークンが未認証の場合は認証ダイアログ(外部OAuth)へ強制遷移し、完了まで画面に戻らない。
- 支払期日フィルタや旧売掛サマリー機能は統合に伴い廃止済み。

## 入力/検証 / Inputs & Validation
- 請求月（From/To）: `<input type="month">`。未指定時は全期間、指定時は該当月の1日〜末日が対象。
- キーワード（請求番号・件名・取引先名に部分一致）。
- 担当/取引先/事業所（テキスト入力）。
- ダウンロード済みステータス（未選択時は全件）。
- リセットボタンで請求月と各種フィルタを初期状態（前月指定）に戻す。

## コンポーネント / Components (shadcn/ui)
- Tailwindベースのフォーム入力とボタンを使用。現状 `shadcn/ui` コンポーネントの直接利用はなし。

## セレクタ / Test Selectors
- 現状 `data-testid` は未定義。E2Eテスト追加時はフィルタフォームと主要テーブルに識別子を付与する。

## i18n / アクセシビリティ
- 表示テキストは日本語固定。将来的な多言語対応は未実装。
- フォーム要素に `label` と `htmlFor` を設定済み。
- ボタンはキーボード操作可能。

## 計測 / Telemetry
- 現状、イベント計測は実装されていない。

## スクリーンショット
- TODO: 最新UIのスクリーンショットを取得し、リンクを追記する。
